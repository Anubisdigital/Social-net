<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CarbonKind - Account Access</title>

<link rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css">

<style>
* { box-sizing: border-box; font-family: system-ui, sans-serif; }

body {
    background: linear-gradient(135deg, #0A433A, #1B5E20, #33691E);
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #F1F8E9;
}

.auth-section {
    width: 100%;
    max-width: 450px;
    background: rgba(255,255,255,0.08);
    backdrop-filter: blur(8px);
    border-radius: 20px;
    padding: 2rem;
    text-align: center;
}

h1 {
    font-size: 2.4rem;
    background: linear-gradient(45deg,#4CAF50,#FFC107);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

#loginBtn {
    margin-top: 20px;
    width: 100%;
    padding: 14px;
    font-size: 16px;
    font-weight: 600;
    border-radius: 10px;
    border: none;
    cursor: pointer;
    background: #4CAF50;
    color: white;
}

#loginBtn:hover {
    background: #45a049;
}

#toast {
    position: fixed;
    bottom: 20px;
    right: 20px;
    padding: 15px 25px;
    border-radius: 10px;
    color: white;
    display: none;
}

#toast.success { background: #4CAF50; }
#toast.error { background: #d32f2f; }
#toast.warning { background: #ff9800; }
</style>
</head>

<body>

<section class="auth-section">
    <h1>CarbonKind</h1>
    <p>Sign in to continue</p>

    <div id="firebaseui-auth-container"></div>

    <button id="loginBtn">Login</button>
</section>

<div id="toast"></div>

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>

<script>
/* ================= FIREBASE CONFIG ================= */
firebase.initializeApp({
    apiKey: "AIzaSyD-YxRrtWHA4wEZc0_zTzoYhK4S5cJOJ34",
    authDomain: "watchbase-d25ad.firebaseapp.com",
    projectId: "watchbase-d25ad",
    appId: "1:209882344898:web:212ed39d768a112d727a5b"
});

/* ================= TOAST ================= */
function showToast(msg, type) {
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.className = type;
    t.style.display = "block";
    setTimeout(() => t.style.display = "none", 3000);
}

/* ================= FIREBASE UI ================= */
const ui = new firebaseui.auth.AuthUI(firebase.auth());

ui.start("#firebaseui-auth-container", {
    signInFlow: "popup",
    signInOptions: [
        firebase.auth.EmailAuthProvider.PROVIDER_ID,
        firebase.auth.GithubAuthProvider.PROVIDER_ID
    ],
    callbacks: {
        signInSuccessWithAuthResult: function(authResult) {
            localStorage.setItem("carbonkind_user", JSON.stringify({
                uid: authResult.user.uid,
                email: authResult.user.email
            }));
            window.location.href = "paper8.html";
            return false;
        }
    }
});

/* ================= MANUAL LOGIN BUTTON ================= */
async function manualLogin() {
    const email = document.querySelector('input[type="email"]')?.value;
    const password = document.querySelector('input[type="password"]')?.value;

    if (!email || !password) {
        showToast("Enter email and password", "warning");
        return;
    }

    try {
        const res = await firebase.auth().signInWithEmailAndPassword(email, password);

        localStorage.setItem("carbonkind_user", JSON.stringify({
            uid: res.user.uid,
            email: res.user.email
        }));

        showToast("Login successful", "success");
        setTimeout(() => location.href = "paper8.html", 800);

    } catch (e) {
        showToast("Invalid login", "error");
    }
}

document.getElementById("loginBtn").addEventListener("click", manualLogin);

/* ================= AUTO REDIRECT IF LOGGED IN ================= */
firebase.auth().onAuthStateChanged(user => {
    if (user) location.href = "paper8.html";
});
</script>

</body>
</html>
