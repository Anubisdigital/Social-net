<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CarbonKind - Account Access</title>
    <meta name="description" content="CarbonKind - Access your account">

    <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.css">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    
    <style>    
        * {    
            margin: 0;    
            padding: 0;    
            box-sizing: border-box;    
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;    
        }    
            
        :root {    
            --primary: #4CAF50; /* Green */
            --accent: #FFC107; /* Amber for highlights */
            --light: #F1F8E9; /* Pale Green/Light */
            --dark: #212121;    
        }    
            
        body {    
            /* Dark/Green background */
            background: linear-gradient(135deg, #0A433A, #1B5E20, #33691E); 
            color: var(--light);    
            min-height: 100vh;    
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }    
            
        .container {    
            width: 100%;
            max-width: 450px;
        }    
            
        .auth-section {    
            /* Semi-transparent, mossy background */
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(8px);    
            border-radius: 20px;    
            padding: 2rem;    
            border: 1px solid rgba(255, 255, 255, 0.15);    
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            text-align: center;
        }    
            
        .logo {    
            display: flex;    
            align-items: center;    
            justify-content: center;    
            gap: 15px;    
            margin-bottom: 1.5rem;    
        }    
        
        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: cover;
        }
            
        .logo h1 {    
            font-size: 2.5rem;    
            background: linear-gradient(45deg, var(--primary), var(--accent));    
            -webkit-background-clip: text;    
            -webkit-text-fill-color: transparent;    
            background-clip: text;    
        }
            
        .section-title {    
            font-size: 1.2rem;    
            color: var(--light);    
            margin-bottom: 1rem;
        }
        
        .welcome-text {
            font-size: 1rem;
            color: rgba(241, 248, 233, 0.8);
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        /* Loading Indicator */    
        #loading {    
            padding: 1rem;    
            font-size: 1.1rem;    
            color: var(--primary);    
        }    
        
        /* FirebaseUI Container */    
        #firebaseui-auth-container {    
            margin-top: 1rem;    
        }
        
        /* Customize FirebaseUI buttons */
        .firebaseui-idp-button {
            border-radius: 10px !important;
            margin-bottom: 12px !important;
            transition: all 0.3s ease !important;
        }
        
        .firebaseui-idp-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
        }
        
        .firebaseui-idp-github {
            background-color: #333 !important;
        }
        
        .firebaseui-idp-github:hover {
            background-color: #444 !important;
        }
        
        .firebaseui-idp-email {
            background-color: var(--primary) !important;
        }
        
        .firebaseui-idp-email:hover {
            background-color: #45a049 !important;
        }
        
        /* Divider */
        .divider {
            display: flex;
            align-items: center;
            margin: 1.5rem 0;
            color: rgba(241, 248, 233, 0.6);
            font-size: 0.9rem;
        }
        
        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .divider span {
            padding: 0 15px;
        }
        
        /* Features List */
        .features {
            text-align: left;
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 15px;
            border-left: 4px solid var(--accent);
        }
        
        .features h3 {
            color: var(--accent);
            margin-bottom: 15px;
            font-size: 1.1rem;
        }
        
        .features ul {
            list-style: none;
            padding: 0;
        }
        
        .features li {
            margin-bottom: 10px;
            padding-left: 24px;
            position: relative;
            color: rgba(241, 248, 233, 0.9);
        }
        
        .features li::before {
            content: 'âœ“';
            position: absolute;
            left: 0;
            color: var(--primary);
            font-weight: bold;
        }
        
        /* Footer */
        .footer {
            margin-top: 2rem;
            font-size: 0.85rem;
            color: rgba(241, 248, 233, 0.6);
            text-align: center;
        }
        
        .footer a {
            color: var(--accent);
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        /* Toast Notification */
        #toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            max-width: 350px;
        }
        
        #toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        #toast.error {
            background: rgba(211, 47, 47, 0.9);
        }
        
        #toast.warning {
            background: rgba(255, 152, 0, 0.9);
        }
        
        #toast.success {
            background: rgba(76, 175, 80, 0.9);
        }
            
        .hidden {    
            display: none !important;    
        }
        
        /* Responsive */
        @media (max-width: 480px) {
            .auth-section {
                padding: 1.5rem;
            }
            
            .logo h1 {
                font-size: 2rem;
            }
            
            .features {
                padding: 1rem;
            }
        }
    </style>  
</head>    
<body>    
    <div class="container">    
        <section class="auth-section">    
            <div class="logo">    
                <img src="anubis.png" alt="CarbonKind Logo" class="logo-img">
                <h1>CarbonKind</h1>    
            </div>    
            
            <h2 class="section-title">Join Our Green Community</h2>    
            <p class="welcome-text">
                Sign in to connect with eco-conscious users, share sustainable ideas, and make a positive impact on our planet.
            </p>
            
            <div id="loading">Loading authentication service...</div>    
            
            <div id="firebaseui-auth-container"></div>    
            
            <div class="divider">
                <span>or sign in with</span>
            </div>
            
            <div class="features">
                <h3>Why Join CarbonKind?</h3>
                <ul>
                    <li>Connect with environmentally conscious people</li>
                    <li>Share sustainable ideas and projects</li>
                    <li>Discover green initiatives and events</li>
                    <li>Track your environmental impact</li>
                    <li>Get inspired by community success stories</li>
                </ul>
            </div>
            
            <div class="footer">
                <p>By signing in, you agree to our <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>.</p>
                <p>Already have an account? Just sign in above! ðŸ‘†</p>
            </div>
        </section>    
    </div>    

    <div id="toast" class="hidden"></div>
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>    
    <script src="https://www.gstatic.com/firebasejs/ui/6.0.0/firebase-ui-auth.js"></script>    
    
    <script>
        // ============================================    
        // FIREBASE CONFIGURATION    
        // ============================================    
        const firebaseConfig = {    
            apiKey: "AIzaSyD-YxRrtWHA4wEZc0_zTzoYhK4S5cJOJ34",    
            authDomain: "watchbase-d25ad.firebaseapp.com",    
            projectId: "watchbase-d25ad",    
            storageBucket: "watchbase-d25ad.firebasestorage.app",    
            messagingSenderId: "209882344898",    
            appId: "1:209882344898:web:212ed39d768a112d727a5b",    
            measurementId: "G-8W240FPXB3"
        };    
      
        // Initialize Firebase    
        firebase.initializeApp(firebaseConfig);    
            
        // Initialize FirebaseUI    
        let ui = null;
            
        // ============================================    
        // UTILITY FUNCTIONS    
        // ============================================    
        function showToast(message, type = 'success') {    
            const toast = document.getElementById('toast');
            toast.innerHTML = `
                <span>${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'âš '}</span>
                <span>${message}</span>
            `;
            toast.className = type;
            toast.classList.remove('hidden');
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => toast.classList.add('hidden'), 300);
            }, 3000);
        }    
            
        // ============================================    
        // FIREBASEUI CONFIGURATION    
        // ============================================    
        const uiConfig = {    
            callbacks: {    
                signInSuccessWithAuthResult: function(authResult, redirectUrl) {    
                    const user = authResult.user;    
                    
                    // Store comprehensive user info in localStorage for the main app
                    const userData = {
                        uid: user.uid,
                        email: user.email,
                        displayName: user.displayName || user.email.split('@')[0],
                        photoURL: user.photoURL || '',
                        provider: authResult.additionalUserInfo.providerId,
                        isNewUser: authResult.additionalUserInfo.isNewUser,
                        signInTime: new Date().toISOString()
                    };
                    
                    localStorage.setItem('carbonkind_user', JSON.stringify(userData));
                    
                    if (authResult.additionalUserInfo.isNewUser) {
                        showToast(`Welcome to CarbonKind, ${user.displayName || user.email}!`, 'success');
                    } else {
                        showToast(`Welcome back, ${user.displayName || user.email}!`, 'success');
                    }
                    
                    // Short delay before redirect to show the toast
                    setTimeout(() => {
                        window.location.href = 'paper8.html';
                    }, 1500);
                    
                    return false; // Don't redirect automatically
                },    
                uiShown: function() {    
                    document.getElementById('loading').classList.add('hidden');    
                },
                signInFailure: function(error) {
                    let errorMessage = 'Sign in failed. ';
                    
                    switch(error.code) {
                        case 'auth/email-already-in-use':
                            errorMessage += 'This email is already registered.';
                            break;
                        case 'auth/invalid-email':
                            errorMessage += 'Invalid email address.';
                            break;
                        case 'auth/operation-not-allowed':
                            errorMessage += 'Email/password accounts are not enabled.';
                            break;
                        case 'auth/weak-password':
                            errorMessage += 'Password is too weak.';
                            break;
                        case 'auth/user-disabled':
                            errorMessage += 'This account has been disabled.';
                            break;
                        case 'auth/user-not-found':
                            errorMessage += 'No account found with this email.';
                            break;
                        case 'auth/wrong-password':
                            errorMessage += 'Incorrect password.';
                            break;
                        case 'auth/popup-closed-by-user':
                            errorMessage = 'Sign in was cancelled.';
                            break;
                        case 'auth/popup-blocked':
                            errorMessage = 'Popup was blocked by your browser. Please allow popups for this site.';
                            break;
                        default:
                            errorMessage += error.message;
                    }
                    
                    showToast(errorMessage, 'error');
                    return Promise.resolve();
                }
            },    
            signInFlow: 'popup',     
            signInSuccessUrl: 'paper8.html', 
            signInOptions: [    
                {    
                    provider: firebase.auth.EmailAuthProvider.PROVIDER_ID,    
                    requireDisplayName: true,
                    signInMethod: firebase.auth.EmailAuthProvider.EMAIL_PASSWORD_SIGN_IN_METHOD,
                    disableSignUp: {
                        status: false
                    }
                },    
                firebase.auth.GithubAuthProvider.PROVIDER_ID
            ],    
            tosUrl: '#',    
            privacyPolicyUrl: '#',    
            credentialHelper: firebaseui.auth.CredentialHelper.NONE,
            // Customize text
            signInOptionsOrder: [
                firebase.auth.EmailAuthProvider.PROVIDER_ID,
                firebase.auth.GithubAuthProvider.PROVIDER_ID
            ]
        };    
            
        // ============================================    
        // INITIALIZATION    
        // ============================================    
        document.addEventListener('DOMContentLoaded', function() {    
            // Initialize FirebaseUI
            ui = new firebaseui.auth.AuthUI(firebase.auth());
            
            // Start FirebaseUI
            if (ui.isPendingRedirect()) {
                ui.start('#firebaseui-auth-container', uiConfig);
            } else {
                ui.start('#firebaseui-auth-container', uiConfig);
            }
            
            // Check if user is already signed in
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is already signed in, redirect to main app
                    setTimeout(() => {
                        window.location.href = 'paper8.html';
                    }, 1000);
                } else {
                    document.getElementById('loading').classList.add('hidden');
                }
            });
        });
        
        // Handle page visibility change (for better popup handling)
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // Page became visible again, check auth state
                firebase.auth().getRedirectResult().then((result) => {
                    if (result.user) {
                        // User signed in via redirect
                        const user = result.user;
                        const userData = {
                            uid: user.uid,
                            email: user.email,
                            displayName: user.displayName || user.email.split('@')[0],
                            photoURL: user.photoURL || '',
                            provider: result.additionalUserInfo.providerId,
                            isNewUser: result.additionalUserInfo.isNewUser,
                            signInTime: new Date().toISOString()
                        };
                        
                        localStorage.setItem('carbonkind_user', JSON.stringify(userData));
                        showToast(`Welcome ${user.displayName || user.email}!`, 'success');
                        
                        setTimeout(() => {
                            window.location.href = 'paper8.html';
                        }, 1500);
                    }
                }).catch((error) => {
                    showToast(`Sign in failed: ${error.message}`, 'error');
                });
            }
        });
        
        // Custom CSS for better FirebaseUI appearance
        const customCSS = `
            .firebaseui-container {
                max-width: 100% !important;
            }
            
            .firebaseui-card-content {
                padding: 0 !important;
            }
            
            .firebaseui-textfield.mdl-textfield {
                width: 100% !important;
            }
            
            .firebaseui-input {
                background: rgba(255, 255, 255, 0.1) !important;
                border: 1px solid rgba(255, 255, 255, 0.2) !important;
                color: #F1F8E9 !important;
                border-radius: 8px !important;
                padding: 12px 15px !important;
            }
            
            .firebaseui-input:focus {
                border-color: #4CAF50 !important;
                box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2) !important;
            }
            
            .firebaseui-label {
                color: #F1F8E9 !important;
            }
            
            .firebaseui-textfield.mdl-textfield .firebaseui-label::after {
                background-color: #4CAF50 !important;
            }
            
            .firebaseui-button {
                border-radius: 8px !important;
                font-weight: 600 !important;
                text-transform: none !important;
                font-size: 16px !important;
                padding: 12px 24px !important;
                transition: all 0.3s ease !important;
            }
            
            .firebaseui-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3) !important;
            }
            
            .firebaseui-button-submit {
                background-color: #4CAF50 !important;
            }
            
            .firebaseui-button-submit:hover {
                background-color: #45a049 !important;
            }
            
            .firebaseui-link {
                color: #FFC107 !important;
            }
            
            .firebaseui-link:hover {
                color: #FFCA28 !important;
                text-decoration: underline !important;
            }
            
            .firebaseui-tos {
                color: rgba(241, 248, 233, 0.7) !important;
                font-size: 0.85rem !important;
            }
            
            .firebaseui-error {
                color: #ff5252 !important;
                background: rgba(255, 82, 82, 0.1) !important;
                border-radius: 8px !important;
                padding: 10px !important;
                border: 1px solid rgba(255, 82, 82, 0.3) !important;
            }
        `;
        
        // Add custom CSS
        const style = document.createElement('style');
        style.textContent = customCSS;
        document.head.appendChild(style);
    </script>
</body>    
</html>
